#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <stdint.h>
#include <fcntl.h>
#include <inttypes.h>

// unsigned char checksum (unsigned char *ptr, size_t sz) {
//     unsigned char chk = 0;
//     while (sz-- != 0)
//         chk -= *ptr++;
//     return chk;
// }

uint64_t checksum(unsigned char *ptr)
{
	int file1;
    uint64_t checksum = 0;
    file1 = open(ptr, O_RDONLY); //read only
    if (file1 >= 0)
	{
	    char c;
	    while (read(file1, &c, 1) == 1)
	    {
	    	//nsigned int charToNum = (unsigned int) c; 
	    	checksum += (int64_t) c;
	    }    
	}
	else
	{
		//fail to open		
	}
	return checksum;
}

void writeToFile(unsigned char *file1, unsigned char *file2)
{
	int f1;
	int f2;
	f1 = open(file1, O_RDONLY);
	f2 = open(file2, O_CREAT | O_WRONLY);
	if (f1 >= 0 && f2 >= 0) //open correctly
	{
		char c;
		while (read(f1, &c, 1) == 1) {
	    	write(f2, &c, 1);
		}
	}
	else
	{
		//fail
	}
	// uint64_t csFile1 = checksum(file1);
	// char cs;
	// while (read(csFile1, &cs, 1) == 1) {
    //   write(f2, &cs, 1);
	// }
	close(f1);
	close(f2);
}
int main(int argc, char* argv[])
{
    // printf ("Checksum is 0x%02x\n", y);
    // y = checksum (x, 6);
    uint64_t checksum1 = checksum(argv[1]);
	printf("%" PRIu64 "\n",checksum1);
	writeToFile(argv[1],argv[2]);

    // printf ("Checksum test is 0x%02x\n", y);
    return 0;
}